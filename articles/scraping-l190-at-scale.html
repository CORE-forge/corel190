<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="corel190">
<title>Scraping l190 at Scale • corel190</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><link href="../deps/Dosis-0.4.2/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.2/font.css" rel="stylesheet">
<link href="../deps/Lora-0.4.2/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Scraping l190 at Scale">
<meta property="og:description" content="corel190">
<meta property="og:image" content="https://core-forge.github.io/corel190/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">corel190</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9003</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Play with dati.anticorruzione l190</h6>
    <a class="dropdown-item" href="../articles/scrape-xml-data-from-l190.html">Scrape xml data from l190</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>scraping dati.anticorruzione ANAC at scale</h6>
    <a class="dropdown-item" href="../articles/scraping-l190-at-scale.html">Scraping l190 at Scale</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Scraping l190 at Scale</h1>
            
      
      
      <div class="d-none name"><code>scraping-l190-at-scale.Rmd</code></div>
    </div>

    
    
<p>In this article you are going to perform parallel scraping exploiting <code>corel190</code> and <code>furrr</code> + <code>future</code> as a backend engine. This may be in your interest if you are planning to analyse a large amount of data coming from “below threshold” tenders. It could be also the case for you to store them in some place, S3 or any other relational database for future use i.e. dasbhoards or computing indicators at large scale.</p>
<div class="section level2">
<h2 id="roadmap">roadmap<a class="anchor" aria-label="anchor" href="#roadmap"></a>
</h2>
<p>We are going to need to exploit the <strong>full</strong> power of our machines (in the case you are not leveraging any distributed computing or nodes clusters). because that’s large data. Steps required are going to be as follows</p>
<ol style="list-style-type: decimal">
<li>get internal data (if you’re here maybe you already have done that, in case you haven’t then <code>devtools::install_github(CORE-forge/corel190)</code>)</li>
<li>build robust functions so that we can <em>gently</em> fail</li>
<li>setup parallel backend with <code>furrr</code>
</li>
<li>launch our job</li>
</ol>
</div>
<div class="section level2">
<h2 id="get-internal-data">1.0 Get internal data<a class="anchor" aria-label="anchor" href="#get-internal-data"></a>
</h2>
<p>I made the work fo you, you can load the package i.e. <code><a href="https://core-forge.github.io/corel190/">library(corel190)</a></code> and check <code>registro_comunicaioni</code> to get all l190 CA communications to ANAC grouped by year.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://core-forge.github.io/corel190/">corel190</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">registro_comunicazioni</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="gently-fail-with-posssibly-insistently">2.0 <em>Gently</em> fail with <code>posssibly</code> &amp; <code>insistently</code><a class="anchor" aria-label="anchor" href="#gently-fail-with-posssibly-insistently"></a>
</h2>
<p>package <code>purrr</code> provides convenient wrappers to transform a function by making it run insistently at given retry rate. We are going to set that rate to the one from <code>robots.txt</code> file to be compliant withe the servers hosting the xml resource. “Introduce Yourself, Seek Permission, Take Slowly and Never Ask Twice”, check out <a href="https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01" class="external-link">this Medium article</a> to understand why manners on the web i.e. <em>netiquette</em> matter. Well we are going yo ask it more then once, since we really want that, at least we are going to ask present ourself an give time to process request, i.e. we are going to be <em>polite</em> af.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rate</span> <span class="op">&lt;-</span> <span class="fu">rate_delay</span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">insistent_parse_xml_metadata</span> <span class="op">&lt;-</span> <span class="fu">insistently</span><span class="op">(</span><span class="va">parse_xml_metadata</span>, <span class="va">rate</span>, quiet <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">possible_insistent_parse_xml_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/possibly2.html">possibly2</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="va">insistent_parse_xml_metadata</span>, otherwise <span class="op">=</span> <span class="va">generate_empty_contrss_metadata</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="stup-parallel">3.0 stup parallel<a class="anchor" aria-label="anchor" href="#stup-parallel"></a>
</h2>
<p>Parallel backend to our extent will help up processing more requests by splitting them on R session/ machine cores. However backends performance and setups really depend on your machine resources and OS. The laptopn I am using is a Apple MacOS M1, with that said I could be setting multicore (qequally split computing on cores) and multisessions (equally pslit computin on many R session, imagine many RStudio running in background). Generally all Unix like OS can support multcore, but for the sake of geenrality I will be using here multisession.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DavisVaughan/furrr" class="external-link">furrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span><span class="op">)</span></span>
<span></span>
<span><span class="va">furrr</span><span class="op">:</span><span class="fu">future_map_dfr</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="launch-jobs">4.0 launch Jobs<a class="anchor" aria-label="anchor" href="#launch-jobs"></a>
</h2>
<p>Do you know that you can run and schedule jobs directly within RStudio and avoid to wait for them to be completed? This is a rather unknown yet powerful rstudio built-in feature (RSudio version&gt;?) which allows users to set up computing intesive tasks without stopping them working on other things.</p>
<p>… intro jto jobs and scereenshots</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Niccolò Salvini.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
